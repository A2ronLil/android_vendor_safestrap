#!/system/bin/sh
# By: Hashcode and Edgan
# hijack.killall: Credit Cyanogenmod, Modified for Busybox
# Version: 1.0
PATH=/system/xbin:/system/bin
REC_FILE=/system/etc/recovery/flags/recovery_mode
ALT_SYSTEM_FILE=/system/etc/recovery/flags/alt_system_mode
RECOVERY_DIR=/system/etc/recovery
HIJACKED_PROP=ro.hijacked
HIJACKED=$(getprop $HIJACKED_PROP)
BOOTMODE=$(getprop ro.bootmode)
CHECK_BOOTMODE="bp-tools"

if [ "$HIJACKED" -eq "1" ]; then
	/system/bin/logwrapper.bin "$@"
	exit
fi

# boot modes= ap-bp-bypass, bp-tools
# check the boot mode from the recovery file
if [ -f "$REC_FILE" ]; then
	CHECK_BOOTMODE=`cat $REC_FILE`
fi
if [ "$BOOTMODE" = "$CHECK_BOOTMODE" ]; then
	/system/etc/safestrap/ss_start_recovery.sh
	exit
else
	/system/etc/safestrap/safestrapsplash
	exit
fi

/system/bin/logwrapper.bin "$@"

